!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},r={},i={}.hasOwnProperty,a={},n=function(e,t){var r=0;t&&(t.indexOf(!1)&&(r="components/".length),t.indexOf("/",r)>0&&(t=t.substring(r,t.indexOf("/",r))));var i=a[e+"/index.js"]||a[t+"/deps/"+e+"/index.js"];return i?"components/"+i.substring(0,i.length-".js".length):e},o=function(){var e=/^\.\.?(\/|$)/;return function(t,r){var i,a,n=[];i=(e.test(r)?t+"/"+r:r).split("/");for(var o=0,s=i.length;s>o;o++)a=i[o],".."===a?n.pop():"."!==a&&""!==a&&n.push(a);return n.join("/")}}(),s=function(e){return e.split("/").slice(0,-1).join("/")},p=function(t){return function(r){var i=o(s(t),r);return e.require(i,t)}},u=function(e,t){var i={id:e,exports:{}};return r[e]=i,t(i.exports,p(e),i),i.exports},c=function(e,a){var s=o(e,".");if(null==a&&(a="/"),s=n(e,a),i.call(r,s))return r[s].exports;if(i.call(t,s))return u(s,t[s]);var p=o(s,"./index");if(i.call(r,p))return r[p].exports;if(i.call(t,p))return u(p,t[p]);throw new Error('Cannot find module "'+e+'" from "'+a+'"')};c.alias=function(e,t){a[t]=e},c.register=c.define=function(e,r){if("object"==typeof e)for(var a in e)i.call(e,a)&&(t[a]=e[a]);else t[e]=r},c.list=function(){var e=[];for(var r in t)i.call(t,r)&&e.push(r);return e},c.brunch=!0,e.require=c}}(),require.register("application",function(e,t,r){var i,a,n,o={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};n=t("routes"),i=t("views/app_layout"),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.initialize=function(){return this.on("start",function(e){return function(t){return e.router=new n({app:e}),e.layout=new i,e.layout.render(),Backbone.history&&Backbone.history.start({pushState:!0}),"function"==typeof Object.freeze?Object.freeze(e):void 0}}(this))},t}(Backbone.Marionette.Application),r.exports=new a}),require.register("initialize",function(e,t,r){var i,a;i=t("./application"),a=function(){var e,r,i,a;r=$("html").attr("lang");try{i=t("locales/"+r)}catch(n){e=n,i=t("locales/en")}return a=new Polyglot({phrases:i,locale:r}),window.t=a.t.bind(a)},$(function(){return a(),i.start()})}),require.register("lib/state_model",function(e,t,r){var i;r.exports=i=function(){function e(e){var t,r;for(t in e)r=e[t],this.add(t,Bacon.constant(r));this.initialize()}return e.prototype.properties={},e.prototype._cache={},e.prototype.initialize=function(){},e.prototype.get=function(e){return this.properties[e]?this.properties[e]:Bacon.constant(void 0)},e.prototype.add=function(e,t){return this.properties[e]||(this.properties[e]=t,t.onValue(function(t){return function(r){return t._cache[e]=r}}(this))),t},e.prototype.toJSON=function(){return this._cache},e}()}),require.register("lib/timezones",function(e,t,r){r.exports=["Europe/Paris","Europe/Berlin","Europe/Madrid","Europe/Rome","America/Los_Angeles","America/New_York","Africa/Abidjan","Africa/Accra","Africa/Addis_Ababa","Africa/Algiers","Africa/Asmara","Africa/Bamako","Africa/Bangui","Africa/Banjul","Africa/Bissau","Africa/Blantyre","Africa/Brazzaville","Africa/Bujumbura","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/Conakry","Africa/Dakar","Africa/Dar_es_Salaam","Africa/Djibouti","Africa/Douala","Africa/El_Aaiun","Africa/Freetown","Africa/Gaborone","Africa/Harare","Africa/Johannesburg","Africa/Kampala","Africa/Khartoum","Africa/Kigali","Africa/Kinshasa","Africa/Lagos","Africa/Libreville","Africa/Lome","Africa/Luanda","Africa/Lubumbashi","Africa/Lusaka","Africa/Malabo","Africa/Maputo","Africa/Maseru","Africa/Mbabane","Africa/Mogadishu","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Niamey","Africa/Nouakchott","Africa/Ouagadougou","Africa/Porto-Novo","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek","America/Adak","America/Anchorage","America/Anguilla","America/Antigua","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Aruba","America/Asuncion","America/Atikokan","America/Bahia","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Cayman","America/Chicago","America/Chihuahua","America/Costa_Rica","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Dominica","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Grenada","America/Guadeloupe","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/La_Paz","America/Lima","America/Los_Angeles","America/Maceio","America/Managua","America/Manaus","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Montreal","America/Montserrat","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santa_Isabel","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/St_Johns","America/St_Kitts","America/St_Lucia","America/St_Thomas","America/St_Vincent","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Tortola","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife","Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Mawson","Antarctica/McMurdo","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Vostok","Asia/Aden","Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Baghdad","Asia/Bahrain","Asia/Baku","Asia/Bangkok","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Choibalsan","Asia/Chongqing","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Gaza","Asia/Harbin","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kashgar","Asia/Kathmandu","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Kuwait","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Muscat","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Phnom_Penh","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qyzylorda","Asia/Rangoon","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Vientiane","Asia/Vladivostok","Asia/Yakutsk","Asia/Yekaterinburg","Asia/Yerevan","Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/St_Helena","Atlantic/Stanley","Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney","Canada/Atlantic","Canada/Central","Canada/Eastern","Canada/Mountain","Canada/Newfoundland","Canada/Pacific","Europe/Amsterdam","Europe/Andorra","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Helsinki","Europe/Istanbul","Europe/Kaliningrad","Europe/Kiev","Europe/Lisbon","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/Simferopol","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Uzhgorod","Europe/Vaduz","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zaporozhye","Europe/Zurich","GMT","Indian/Antananarivo","Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Comoro","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Mayotte","Indian/Reunion","Pacific/Apia","Pacific/Auckland","Pacific/Chatham","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Johnston","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Midway","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Ponape","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Saipan","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Truk","Pacific/Wake","Pacific/Wallis","US/Alaska","US/Arizona","US/Central","US/Eastern","US/Hawaii","US/Mountain","US/Pacific","UTC"]}),require.register("routes/index",function(e,t,r){var i,a,n,o,s,p={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var i in t)p.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};n=t("views/register"),o=t("states/registration"),a=t("views/auth"),i=t("states/auth"),r.exports=s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return u(t,e),t.prototype.routes={"login(?next=*path)":"login","login(/*path)":"login","password/reset/:key":"resetPassword","register(?step=:step)":"register"},t.prototype.initialize=function(e){return this.app=e.app},t.prototype.auth=function(e,t){var r;return r=new i({next:e}),this.app.layout.showChildView("content",new a(_.extend(t,{model:r})))},t.prototype.login=function(e){return null==e&&(e="/"),window.location.hash&&(e=window.location.hash),this.auth(e,{backend:"/login",type:"login"})},t.prototype.resetPassword=function(e){return this.auth("/login",{backend:window.location.pathname,type:"reset"})},t.prototype.register=function(e){var t,r;return null==e&&(e="preset"),t=this.app.layout.getChildView("content"),null!=t&&t instanceof n||(r=new o,r.get("step").map(function(e){return e?"register?step="+e:void 0}).assign(this,"navigate"),t=new n({model:r}),this.app.layout.showChildView("content",t)),t.model.setStep(e)},t}(Backbone.Router)}),require.register("states/auth",function(e,t,r){var i,a,n=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};a=t("lib/state_model"),r.exports=i=function(e){function t(){return this.sendResetSubmit=n(this.sendResetSubmit,this),this.signinSubmit=n(this.signinSubmit,this),t.__super__.constructor.apply(this,arguments)}return s(t,e),t.prototype.initialize=function(){return this.isBusy=new Bacon.Bus,this.alert=new Bacon.Bus,this.success=new Bacon.Bus,this.signin=new Bacon.Bus,this.sendReset=new Bacon.Bus,this.add("alert",this.alert.toProperty()),this.signin.onValue(this.signinSubmit),this.sendReset.onValue(this.sendResetSubmit),this.success.map(this.get("next")).onValue(function(e){return setTimeout(function(){var t;return t=window.location,window.location.href=""+t.protocol+"//"+t.host+e},500)})},t.prototype.signinSubmit=function(e){var t,r;return t=JSON.stringify({password:e.password}),r=Bacon.fromPromise($.post(e.action,t)),this.success.plug(r.map(".success")),this.alert.plug(r.map(!1)),this.alert.plug(r.errors().mapError({status:"error",title:"wrong password title",message:"wrong password message"})),this.isBusy.plug(r.mapEnd(!1))},t.prototype.sendResetSubmit=function(){var e;return e=Bacon.fromPromise($.post("/login/forgot")),this.alert.plug(e.map({status:"success",title:"recover sent title",message:"recover sent message"})),this.alert.plug(e.errors().mapError({status:"error",title:"recover error title",message:"recover error message"}))},t}(a)}),require.register("states/registration",function(e,t,r){var i,a,n=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},p=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};a=t("lib/state_model"),r.exports=i=function(e){function r(){return this.signupSubmit=n(this.signupSubmit,this),r.__super__.constructor.apply(this,arguments)}return s(r,e),r.prototype.steps=function(){var e;return e=p.call(t("env").apps,"import-from-google")>=0,{preset:{next:e?"import":"setup",nextLabel:"sign up"},"import":{next:"setup",nextLabel:"skip"},import_google:{nocontrols:!0},setup:{next:"welcome",nocontrols:!0},welcome:{nextLabel:"welcome"}}}(),r.prototype.initialize=function(){return this.errors=new Bacon.Bus,this.initStep(),this.initControls(),this.initSignup(),this.initSetEmail()},r.prototype.setStep=function(e){return this.setStepBus.push(e)},r.prototype.initStep=function(){var e;return this.setStepBus=new Bacon.Bus,this.stepValve=new Bacon.Bus,e=this.setStepBus.holdWhen(this.stepValve.startWith(!1).toProperty()).filter(function(e){return function(t){return p.call(Object.keys(e.steps),t)>=0}}(this)).toProperty(null),this.add("step",e),this.add("nextStep",e.map(function(e){return function(t){var r;return(null!=(r=e.steps[t])?r.next:void 0)||null}}(this)))},r.prototype.initControls=function(){var e;return this.nextEnabled=new Bacon.Bus,this.nextBusy=new Bacon.Bus,this.nextLabel=new Bacon.Bus,e=Bacon.combineTemplate({enabled:this.nextEnabled.startWith(!0).toProperty(),busy:this.nextBusy.startWith(!1).toProperty(),label:this.nextLabel.startWith("next").toProperty(),visible:this.get("step").map(function(e){return function(t){var r;return!(null!=(r=e.steps[t])?r.nocontrols:void 0)}}(this))}),this.nextLabel.plug(this.get("step").map(function(e){return function(t){var r;return null!=(r=e.steps[t])?r.nextLabel:void 0}}(this))),this.setStepBus.filter(function(e){return function(t){return!(p.call(Object.keys(e.steps),t)>=0)}}(this)).onValue(function(e){var t;return t=window.location,window.location.href=""+t.protocol+"//"+t.host+e}),this.add("nextControl",e)},r.prototype.initSignup=function(){return this.signup=new Bacon.Bus,this.stepValve.plug(this.get("step").map(function(e){return"preset"===e})),this.nextEnabled.plug(this.get("step").map(function(e){return"preset"!==e})),this.signup.onValue(this.signupSubmit)},r.prototype.signupSubmit=function(e){var t;return t=Bacon.fromPromise($.post("/register",JSON.stringify(e))),t.subscribe(function(){return window.username=e.public_name}),this.stepValve.plug(t.map(!1)),this.errors.plug(t.errors().mapError(".responseJSON.errors")),this.nextBusy.plug(t.mapEnd(!1))},r.prototype.initSetEmail=function(){return this.setEmail=new Bacon.Bus,this.setEmail.onValue(this.setEmailSubmit)},r.prototype.setEmailSubmit=function(e){var t,r;return r=e["imap-login"]||e.email,t={id:null,label:e.email,name:e.email.split("@")[0],login:r,password:e.password,accountType:"IMAP",draftMailbox:"",favoriteMailboxes:null,imapPort:e["imap-port"],imapSSL:e["imap-ssl"],imapServer:e["imap-server"],imapTLS:!1,smtpLogin:e["smtp-login"]||r,smtpMethod:"PLAIN",smtpPassword:e["smtp-password"]||e.password,smtpPort:e["smtp-port"],smtpSSL:e["smtp-ssl"],smtpServer:e["smtp-server"]||e["imap-server"],smtpTLS:!1,mailboxes:"",sentMailbox:"",trashMailbox:""},$.ajax({type:"POST",url:"/apps/emails/account",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json"})},r}(a)}),require.register("views/app_layout",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template=t("views/templates/layout_app"),r.prototype.el="[role=application]",r.prototype.regions={content:".container"},r}(Mn.LayoutView)}),require.register("views/auth/feedback",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template=t("views/templates/view_auth_feedback"),r.prototype.ui={forgot:"a.forgot"},r.prototype.serializeData=function(){return _.extend(this.model.toJSON(),{forgot:this.options.forgot,prefix:this.options.prefix})},r.prototype.initialize=function(){var e;return this.model.get("alert").subscribe(this.render),this.model.alert.map(function(e){return e.status?e.status:null}).assign(this.$el,"attr","class"),this.options.forgot?(e=this.$el.asEventStream("click",this.ui.forgot).doAction(".preventDefault"),this.model.sendReset.plug(e)):void 0},r}(Mn.ItemView)}),require.register("views/auth/index",function(e,r,i){var a,n,o={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};n=r("views/auth/feedback"),i.exports=a=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return s(i,e),i.prototype.tagName="form",i.prototype.className=function(){return""+this.options.type+" auth"},i.prototype.attributes=function(){var e;return e={method:"POST",action:this.options.backend}},i.prototype.template=r("views/templates/view_auth"),i.prototype.regions={feedback:".feedback"},i.prototype.ui={passwd:"input[type=password]",submit:".controls button[type=submit]"},i.prototype.serializeData=function(){return{username:r("env").username,prefix:this.options.type}},i.prototype.initialize=function(){var e,t,r,i;return r=this.$el.asEventStream("focus keyup blur",this.ui.passwd).map(".target.value").toProperty(""),this.passwordEntered=r.map(function(e){return!!e}),i=this.$el.asEventStream("click",this.ui.submit).doAction(".preventDefault").filter(this.passwordEntered),t={password:r,action:this.options.backend},e=Bacon.combineTemplate(t).sampledBy(i),this.model.isBusy.plug(e.map(!0)),this.model.signin.plug(e)},i.prototype.onRender=function(){return this.showChildView("feedback",new n({forgot:"login"===this.options.type,prefix:this.options.type,model:this.model})),this.ui.passwd.asEventStream("focus").assign(this.ui.passwd[0],"select"),setTimeout(function(e){return function(){return e.ui.passwd.focus()}}(this),100),setTimeout(function(e){return function(){return e.ui.passwd.focus()}}(this),300),this.model.isBusy.assign(this.ui.submit,"attr","aria-busy"),this.model.success.map(function(e){return function(){return $("<i/>",{"class":"fa fa-check",text:t(""+e.options.type+" auth success")})}}(this)).assign(this.ui.submit,"html"),this.model.success.assign(this.ui.submit,"toggleClass","btn-success"),this.model.alert.assign(this.ui.passwd[0],"select")},i}(Mn.LayoutView)}),require.register("views/lib/form_view",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.inputsStream=this.$el.asEventStream("keyup blur change",this.ui.inputs),this.submitStream=this.$el.asEventStream("submit").doAction(".preventDefault").filter(function(e){return function(){return e.model.get("nextControl").map(".enabled")}}(this))}return n(t,e),t.prototype.tagName="form",t.prototype.ui={labels:"label.with-input",inputs:":input"},t.prototype.initForm=function(){var e,t,r;return t={},r=Bacon.constant(!0),e=function(e){return"checkbox"===e.type?e.checked:e.value},this.ui.inputs.map(function(i){return function(a,n){var o;return o=i.inputsStream.map(".target").filter(function(e){return e===n}).map(e).toProperty(e(n)),t[n.name]=o,n.required?r=r.and(o.map(function(e){return!!e})):void 0}}(this)),this.model.setStepBus.plug(this.submitStream.map(this.model.get("nextStep"))),this.form=Bacon.combineTemplate(t).sampledBy(this.model.nextClickStream.merge(this.submitStream)).filter(r),this.required=r},t.prototype.initErrors=function(){var e,t,r,i,a,n,o;r=function(e){return!!e},t=function(e){return $("<p/>",{"class":"error",text:e})},this.model.errors.filter(function(e){return!!e}).subscribe(function(e){return function(){return e.ui.labels.find(".error").remove()}}(this)),n=this.errors,o=[];for(i in n)a=n[i],e=this.ui.labels.filter("[for=preset-"+i+"]"),a.map(r).assign(e,"attr","aria-invalid"),o.push(a.filter(r).map(t).assign(e,"append"));return o},t}(Mn.ItemView)}),require.register("views/register/controls",function(e,r,i){var a,n={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i.exports=a=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype.template=r("views/templates/view_register_controls"),i.prototype.ui={next:"a.btn"},i.prototype.initialize=function(){var e;return e=this.$el.asEventStream("click",this.ui.next).doAction(".preventDefault").map(function(e){return e.target.href.split("=")[1]||"/"}).filter(function(e){return function(){return e.model.get("nextControl").map(".enabled")}}(this)),this.model.nextClickStream=e,this.model.setStepBus.plug(e)},i.prototype.onRender=function(){var e;return this.model.get("nextControl").map(".enabled").not().assign(this.ui.next,"attr","aria-disabled"),this.model.get("nextControl").map(".busy").assign(this.ui.next,"attr","aria-busy"),this.model.get("nextStep").map(function(e){return e?"register?step="+e:"/"}).assign(this.ui.next,"attr","href"),this.model.get("nextControl").map(".label").filter(function(e){return void 0!==e}).map(function(e){return function(){return t(e)}}).assign(this.ui.next,"text"),e=this.model.get("nextControl").map(".label").map(function(e){return"skip"===e}),e.assign(this.ui.next,"toggleClass","btn-secondary"),e.not().assign(this.ui.next,"toggleClass","btn-primary")},i}(Mn.ItemView)}),require.register("views/register/feedback",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.template=t("views/templates/view_register_feedback"),r.prototype.onRender=function(){return this.model.get("step").map(function(e){return function(){return this.classList.contains(e)}}).assign(this.$("li"),"attr","aria-selected"),this.model.get("step").map(function(e){return/^welcome/.test(e)}).assign(this.$el,"attr","aria-hidden")},r}(Mn.ItemView)}),require.register("views/register/import",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="import",r.prototype.template=t("views/templates/view_register_import"),r.prototype.ui={google:"#import-google"},r.prototype.initialize=function(){var e;return e=this.$el.asEventStream("click",this.ui.google).doAction(".preventDefault").map(function(e){return e.target.href.split("=")[1]}),this.model.setStepBus.plug(e)},r}(Mn.ItemView)}),require.register("views/register/import_google",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="import-google",r.prototype.template=t("views/templates/view_register_import_google"),r.prototype.events={"click #cancel":"cancel","click #lg-ok":"selectedScopes","click #step-pastecode-ok":"pastedCode","click .nav":"navToStep"},r.prototype.pastedCode=function(e){var t;return e.preventDefault(),null!=(t=this.popup)&&t.close(),this.auth_code=this.$("input:text[name=auth_code]").val(),this.$("input:text[name=auth_code]").val(""),this.changeStep("pickscope")},r.prototype.selectedScopes=function(e){var t,r,i;return e.preventDefault(),i={photos:!1,calendars:this.$("input:checkbox[name=calendars]").prop("checked"),contacts:this.$("input:checkbox[name=contacts]").prop("checked"),sync_gmail:!1},t={auth_code:this.auth_code,scope:i},$.post("/apps/import-from-google/lg",t),r=[],i.contacts&&r.push("contacts"),i.calendars&&r.push("calendars"),r.length&&this.model.add("imports",Bacon.constant(r)),this.model.setStep("setup")},r.prototype.changeStep=function(e){return this.$(".step").hide(),this.$("#step-"+e).show(),"pastecode"===e?(setTimeout(function(){return this.$("#auth_code").focus()},30),this._authPopup()):void 0},r.prototype.cancel=function(){return this.model.setStep("import")},r.prototype.navToStep=function(e){return e.preventDefault(),this.changeStep(e.currentTarget.dataset.target)},r.prototype.onRender=function(){return this.changeStep("sign-in")},r.prototype._authPopup=function(){var e,t,r,i;return r="toolbars=0, width=700, height=600, left=200, top=200, scrollbars=1, resizable=1",i="https://www.googleapis.com/auth/calendar.readonly https://picasaweb.google.com/data/ https://www.googleapis.com/auth/contacts.readonly email https://mail.google.com/ profile",e="260645850650-2oeufakc8ddbrn8p4o58emsl7u0r0c8s.apps.googleusercontent.com",t="https://accounts.google.com/o/oauth2/auth?scope="+encodeURIComponent(i)+"&response_type=code&client_id="+e+"&redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob",this.popup=window.open(t,"Google OAuth",r)},r}(Mn.ItemView)}),require.register("views/register/index",function(e,t,r){var i,a,n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,p=function(e,t){function r(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=t("views/register/controls"),a=t("views/register/feedback"),r.exports=n=function(e){function r(){return this.swapStep=o(this.swapStep,this),r.__super__.constructor.apply(this,arguments)}return p(r,e),r.prototype.className="register",r.prototype.template=t("views/templates/view_base"),r.prototype.regions={content:"[role=region]",controls:".controls",feedback:".feedback"},r.prototype.ui={footer:"footer"},r.prototype.initialize=function(){return this.model.get("step").onValue(this.swapStep)},r.prototype.onRender=function(){return this.showChildView("controls",new i({model:this.model})),this.showChildView("feedback",new a({model:this.model})),this.model.get("nextControl").map(".visible").not().assign(this.ui.footer,"attr","aria-hidden")},r.prototype.swapStep=function(e){var r;if(e)return r=t("views/register/"+e),this.showChildView("content",new r({model:this.model}))},r}(Mn.LayoutView)}),require.register("views/register/preset",function(e,t,r){var i,a,n={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=t("views/lib/form_view"),r.exports=a=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return o(r,e),r.prototype.className="preset",r.prototype.attributes={method:"post",action:"/register"},r.prototype.template=t("views/templates/view_register_preset"),r.prototype.serializeData=function(){return{timezones:t("lib/timezones")}},r.prototype.initialize=function(){var e;return e=this.$el.asEventStream("blur","#preset-email").map(".target.value").toProperty(""),this.model.add("email",e),this.errors={email:this.model.errors.map(".email"),password:this.model.errors.map(".password"),timezone:this.model.errors.map(".timezone")}},r.prototype.onRender=function(){var e;return this.initForm(),this.initErrors(),this.onStep=this.model.get("step").sampledBy(this.form).map(function(e){return"preset"===e}).toProperty(),this.model.nextEnabled.plug(this.required.changes()),e=this.form.filter(this.onStep),this.model.signup.plug(e),this.model.nextBusy.plug(e.map(!0))},r}(i)}),require.register("views/register/setup",function(e,t,r){var i,a,n,o=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,p=function(e,t){function r(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},u=[].slice;n=null,a=function(e){var t;return n||(n=window.io(window.location.origin,{path:"/apps/import-from-google/socket.io",reconnectionDelayMax:6e4,reconectionDelay:2e3,reconnectionAttempts:3})),t="calendars"===e?"events":e,Bacon.fromBinder(function(r){var i,a,o;return i=function(){return r(100),r(new Bacon.End)},a=function(){return r(100),r(new Bacon.Error("import error"))},o=_.debounce(a,15e3),r(0),setTimeout(function(){return n.disconnected?a():void 0},2500),n.on(e,function(e){return r(Math.floor(e.number/e.total*100)),o()}),n.on(""+t+".end",i),n.on("ok",i),n.on("invalid token",a),function(){}})},r.exports=i=function(e){function r(){return this.initCounter=o(this.initCounter,this),this.onError=o(this.onError,this),r.__super__.constructor.apply(this,arguments)}return p(r,e),r.prototype.className="setup",r.prototype.template=t("views/templates/view_register_setup"),r.prototype.ui={bar:"progress"},r.prototype.onBeforeRender=function(){return this.model.get("imports").onValue(this.initCounter)},r.prototype.onRender=function(){return this.progress.assign(this.ui.bar,"val")},r.prototype.onError=function(){var e;if(!this.$(".error").length)return e=window.t("import error"),this.ui.bar.after($("<p/>",{"class":"error",text:e}))},r.prototype.initCounter=function(e){var t,r,i,n;return n=function(){return Bacon.interval(80,1).take(100).scan(0,function(e,t){return e+t}).toProperty()},e?(r=function(){var e;return e=[].reduce.call(arguments,function(e,t){return e+t},0),Math.floor(e/arguments.length)},i=e.map(function(e){return a(e).toProperty()}),this.progress=Bacon.combineWith.apply(Bacon,[r,n()].concat(u.call(i))),
this.progress.onError(this.onError)):this.progress=n(),t=this.progress.filter(function(e){return e>=100}).map(this.model.steps.setup.next),this.model.setStepBus.plug(t)},r}(Mn.ItemView)}),require.register("views/register/welcome",function(e,t,r){var i,a={}.hasOwnProperty,n=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r.exports=i=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.className="welcome",r.prototype.template=t("views/templates/view_register_welcome"),r}(Mn.ItemView)}),require.register("views/templates/layout_app",function(e,t,r){var i=function(e){var t=[];return t.push('<section class="popup"><header><a href="http://cozy.io" target="_blank" title="Cozy Website"></a></header><div class="container"></div></section>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof r&&r&&r.exports&&(r.exports=i)}),require.register("views/templates/view_auth",function(e,r,i){var a=function(e){var r,i=[],a=e||{},n=a.prefix,o=a.username;return i.push('<div role="region"><h1>'+jade.escape(null==(r=t(n+" welcome",{username:o}))?"":r)+'</h1><p id="login-password-tip" class="help">'+jade.escape(null==(r=t(n+" enter your password",{username:o}))?"":r)+"</p><label"+jade.attr("for",""+n+"-password",!0,!1)+jade.attr("aria-describedby",""+n+"-password-tip",!0,!1)+' class="with-input"><span>'+jade.escape(null==(r=t(n+" password"))?"":r)+"</span><input"+jade.attr("id",""+n+"-password",!0,!1)+' name="password" type="password" autofocus="autofocus"/></label></div><footer><div class="controls"><button type="submit" class="btn btn-primary">'+jade.escape(null==(r=t(n+" submit"))?"":r)+'</button></div><div class="feedback"></div></footer>'),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_auth_feedback",function(e,r,i){var a=function(e){var r,i=[],a=e||{},n=a.alert,o=a.prefix,s=a.forgot,p=a.label;return n&&i.push('<div class="alert"><p><strong>'+jade.escape(null==(r=t(o+" "+n.title))?"":r)+"</strong></p><p>"+jade.escape(null==(r=t(o+" "+n.message))?"":r)+"</p></div>"),s&&(i.push('<div class="recover">'),p=t(n&&"success"==n.status?"login recover again":"login recover"),i.push('<a href="/login/forgot" class="forgot">'+jade.escape(null==(r=p)?"":r)+"</a></div>")),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_base",function(e,t,r){var i=function(e){var t=[];return t.push('<div role="region"></div><footer><div class="controls"></div><div class="feedback"></div></footer>'),t.join("")};"function"==typeof define&&define.amd?define([],function(){return i}):"object"==typeof r&&r&&r.exports&&(r.exports=i)}),require.register("views/templates/view_register_controls",function(e,r,i){var a=function(e){var r,i=[];return i.push('<a href="/register?step=null" class="btn btn-primary">'+jade.escape(null==(r=t("next"))?"":r)+"</a>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_feedback",function(e,r,i){var a=function(e){var r,i=[];return i.push('<ul><li class="preset">'+jade.escape(null==(r=t("step preset"))?"":r)+'</li><li class="import">'+jade.escape(null==(r=t("step import"))?"":r)+'</li><li class="email">'+jade.escape(null==(r=t("step email settings"))?"":r)+"</li></ul>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_import",function(e,r,i){var a=function(e){var r,i=[];return i.push('<div id="import-google" class="content-block"><div class="content-illustration google-services"></div><h2>'+jade.escape(null==(r=t("import google account"))?"":r)+"</h2><p>"+jade.escape(null==(r=t("import google account tip"))?"":r)+'</p><a id="import-google" type="button" href="/register?step=import_google" class="btn btn-primary">'+jade.escape(null==(r=t("import from google"))?"":r)+"</a></div>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_import_google",function(e,r,i){var a=function(e){var r,i=[];return i.push('<div id="import-google" class="content-block"><h2>'+jade.escape(null==(r=t("leave google title"))?"":r)+'</h2><section id="step-sign-in" class="step"><h3><span class="count">1</span>'+jade.escape(null==(r=t("leave google sign in content"))?"":r)+'</h3><div class="btn-group btn-group-02"><button id="cancel" class="btn btn-secondary">'+jade.escape(null==(r=t("back"))?"":r)+'</button><button data-target="pastecode" class="nav btn btn-primary">'+jade.escape(null==(r=t("leave google sign in"))?"":r)+'</button></div></section><section id="step-pastecode" class="step"><h3><span class="count">2</span>'+jade.escape(null==(r=t("leave google code content"))?"":r)+'</h3><label for="google-code" class="with-input"><span>'+jade.escape(null==(r=t("leave google code"))?"":r)+'</span><input id="auth_code" type="text" name="auth_code" required="required" autofocus="autofocus"/></label><div class="btn-group btn-group-02"><button data-target="sign-in" class="nav btn btn-secondary">'+jade.escape(null==(r=t("back"))?"":r)+'</button><button id="step-pastecode-ok" class="btn btn-primary">'+jade.escape(null==(r=t("confirm"))?"":r)+'</button></div></section><section id="step-pickscope" class="step google-services-list"><h3><span class="count">3</span>'+jade.escape(null==(r=t("leave google choice"))?"":r)+'</h3><label for="google-contacts-import"><input id="google-contacts-import" type="checkbox" name="contacts" value="contacts" checked="checked"/><span class="google-services-icons contacts"></span><span>'+jade.escape(null==(r=t("leave google choice contacts"))?"":r)+'</span></label><label for="google-calendar-import"><input id="google-calendar-import" type="checkbox" name="calendars" value="calendars" checked="checked"/><span class="google-services-icons calendar"></span><span>'+jade.escape(null==(r=t("leave google choice calendar"))?"":r)+'</span></label><div class="btn-group btn-group-02"><button data-target="pastecode" class="nav btn btn-secondary">'+jade.escape(null==(r=t("back"))?"":r)+'</button><button id="lg-ok" class="btn btn-primary">'+jade.escape(null==(r=t("leave google confirm"))?"":r)+'</button></div></section><p class="tip"><a'+jade.attr("href",t("leave google url doc"),!0,!1)+' target="_blank">'+jade.escape(null==(r=t("leave google help me"))?"":r)+"</a></p></div>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_preset",function(e,r,i){var a=function(e){var r,i=[],a=e||{},n=a.timezones;i.push('<label for="preset-email" aria-describedby="preset-email-tip" class="with-input"><span>'+jade.escape(null==(r=t("preset email"))?"":r)+'</span><input id="preset-email" type="email" name="email" autofocus="autofocus" required="required"/><span class="indicator"><span class="fa fa-exclamation-triangle"></span></span></label><p id="preset-email-tip" class="tips">'+jade.escape(null==(r=t("preset email tip"))?"":r)+'</p><label for="preset-name" aria-describedby="preset-name-tip" class="with-input"><span>'+jade.escape(null==(r=t("preset name"))?"":r)+'</span><input id="preset-name" type="text" name="public_name" required="required"/></label><p id="preset-name-tip" class="tips">'+jade.escape(null==(r=t("preset name tip"))?"":r)+'</p><label for="preset-password" aria-describedby="preset-password-tip" class="with-input"><span>'+jade.escape(null==(r=t("preset password"))?"":r)+'</span><input id="preset-password" type="password" name="password" required="required"/><span class="indicator"><span class="fa fa-exclamation-triangle"></span></span></label><p id="preset-email-tip" class="tips">'+jade.escape(null==(r=t("preset password tip"))?"":r)+'</p><label for="preset-timezone" aria-describedby="preset-timezone-tip" class="with-input"><select id="preset-timezone" name="timezone" required="required">');var o=!1,s=null;return function(){var e=n;if("number"==typeof e.length)for(var t=0,a=e.length;a>t;t++){var p=e[t];if(!o){var u=p.split("/")[0];u!=s&&(s=u,t&&i.push('<option disabled="disabled">---</option>')),"africa"==u.toLowerCase()&&(o=!0)}i.push("<option"+jade.attr("value",p,!0,!1)+">"+jade.escape(null==(r=p)?"":r)+"</option>")}else{var a=0;for(var t in e){a++;var p=e[t];if(!o){var u=p.split("/")[0];u!=s&&(s=u,t&&i.push('<option disabled="disabled">---</option>')),"africa"==u.toLowerCase()&&(o=!0)}i.push("<option"+jade.attr("value",p,!0,!1)+">"+jade.escape(null==(r=p)?"":r)+"</option>")}}}.call(this),i.push('</select><span class="indicator"><span class="fa fa-exclamation-triangle"></span></span></label><p id="preset-timezone-tip" class="tips">'+jade.escape(null==(r=t("preset timezone tip"))?"":r)+'</p><div class="checkboxes"><label for="preset-help-us" class="checkbox"><input id="preset-help-us" type="checkbox" name="allow_stats" checked="checked"/><span>'+jade.escape(null==(r=t("preset opt-in help"))?"":r)+'</span></label></div><button type="submit" aria-hidden="true"></button>'),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_setup",function(e,r,i){var a=function(e){var r,i=[];return i.push("<h1>"+jade.escape(null==(r=t("setup title"))?"":r)+'</h1><p class="help">'+jade.escape(null==(r=t("setup message"))?"":r)+'</p><progress value="0" max="100"></progress><h1>'+jade.escape(null==(r=t("setup on mobile title"))?"":r)+'</h1><p class="help">'+jade.escape(null==(r=t("setup on mobile message"))?"":r)+'</p><a href="https://play.google.com/store/apps/details?id=io.cozy.files_client" target="_blank" class="btn-store"><img src="/img/google-play-btn.svg" alt="Get it on Google Play"/></a>'),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)}),require.register("views/templates/view_register_welcome",function(e,r,i){var a=function(e){var r,i=[];return i.push("<h1>"+jade.escape(null==(r=t("welcome title"))?"":r)+'</h1><p class="help">'+jade.escape(null==(r=t("welcome message"))?"":r)+"</p>"),i.join("")};"function"==typeof define&&define.amd?define([],function(){return a}):"object"==typeof i&&i&&i.exports&&(i.exports=a)});